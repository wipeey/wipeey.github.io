---
title: "Building a network for a small business"
date: 2025-06-20
summary: "Setting up switches, routers, computers, servers, access-lists, routing and DHCP on GNS3."
categories: ['Project']
tags: ['GNS3', 'CCNA']
---

# Building a Local Network with VLANs, Routing & Services

## Introduction

This project aims to solidify your hands‑on skills with Layer 2 (switch) and Layer 3 (router) equipment by designing and deploying a multi‑VLAN network in GNS3. You will configure VLANs, implement inter‑VLAN routing, balance traffic with Spanning Tree Protocol, subdivide and assign IP space using VLSM, deploy core services (FTP, HTTP), enforce security policies, and finally connect to an external network representing your IUT.

## I. Network Topology Overview

The target topology (Figure 1) consists of three routers (R1, R2, R3), two distribution switches, and three servers for backup, development, and production. All student teams share the 192.168.128.0/20 address space. VLAN-aware switching is centralized on the "commutateur‑fed" switch to simplify inter‑VLAN routing and security.

## II. VLAN Design and Layer 2 Configuration

### 1. VLAN Assignment

| VLAN Name       | VLAN ID |
| --------------- | ------- |
| Administration  | 100     |
| Developers      | 200     |
| Administrators  | 300     |
| Native (Secure) | 999     |

* **Native VLAN 999**: Move the default native VLAN to 999 and enable tagging on all trunk ports for extra safety.
* **Port‑security**: On both distribution switches, lock each access port to the first MAC address seen (one‑device‑only).

### 2. Spanning Tree Load‑Balancing

Use three physical links between the distribution switches and "commutateur‑fed". Assign one VLAN per link in the STP port‑cost calculation:

1. Link A: VLAN 100
2. Link B: VLAN 200
3. Link C: VLAN 300

In the event of a link failure, STP will automatically reassign blocked ports, ensuring every remaining link can carry all active VLANs.

## III. IP Addressing and Routing

### 1. VLSM Subnetting of 192.168.128.0/20

The /20 network serves 32 students. Each student needs five sub‑nets:

* Administration hosts: 4 addresses
* User hosts: 4 addresses
* Administrator hosts: 4 addresses
* Production hosts: 4 addresses
* Point‑to‑point links (routers & switches): /30 (2‑host) per link

Use Variable Length Subnet Masking (VLSM) to allocate the smallest possible subnets:

* **/29** for each 4‑address LAN (gives 6 usable IPs)
* **/30** for each point‑to‑point link (gives 2 usable IPs)

Configure the campus DHCP server (Serveur‑dhcp) with pools for each VLAN and static reservations for servers.

### 2. Inter‑VLAN Routing on commutateur‑fed

Enable Switched Virtual Interfaces (SVIs) for VLAN 100, 200, 300, and 999. Assign IPs from each student’s /29 networks:

```bash
commutateur-fed(config)# interface vlan 100
commutateur-fed(config-if)# ip address 192.168.x.1 255.255.255.248
# Repeat for VLAN 200, 300, 999
```

### 3. Routing Protocol: RIP v2

On routers R1, R2, and R3, configure RIP v2 to exchange all subnets:

```bash
router(config)# router rip
router(config-router)# version 2
router(config-router)# no auto-summary
router(config-router)# network 192.168.128.0
```

Point‑to‑point links must use /30 subnets and be included under RIP.

## IV. Service Deployment

### 1. FTP Backup Server (Serveur‑sauvegarde)

* Install and enable an FTP daemon (e.g., vsftpd).
* Allow anonymous read‑only access.
* Create two local users:

  * antoine / antoine
  * elise  / elise
* Grant both users read/write permissions in their home directories.

### 2. Web Servers (DEV and PROD)

* Install Apache on both Serveur‑dev and Serveur‑prod.
* Customize the default index.html on Serveur‑dev.
* On Serveur‑prod, use `rsync` (port 873) to pull the DEV site:

```bash
rsync -avz --delete dev:/var/www/html/ /var/www/html/
```

Verify that the PROD server always mirrors the latest DEV content.

## V. Security Policies

### 1. Switch Port Security

```bash
switch(config)# interface range gig1/0/1-48
switch(config-if-range)# switchport mode access
switch(config-if-range)# switchport port-security
switch(config-if-range)# switchport port-security maximum 1
switch(config-if-range)# switchport port-security violation restrict
switch(config-if-range)# switchport port-security mac-address sticky
```

### 2. Router R2 ACLs

Permit only HTTP (80), SSH (22), and rsync (873) between the student LANs and production network:

```bash
ip access-list extended R2_FILTER
  permit tcp any any eq 80
  permit tcp any any eq 22
  permit tcp any any eq 873
  deny   ip any any
exit
interface gig0/1
  ip access-group R2_FILTER in
```

### 3. Border Router R3 ACLs

Allow only ICMP and HTTP from the external cloud into the campus:

```bash
ip access-list extended R3_INBOUND
  permit icmp any any
  permit tcp any any eq 80
  deny   ip any any
exit
interface serial0/0
  ip access-group R3_INBOUND in
```

## VI. External Connectivity to the IUT Network

Use the GNS3 Cloud object to represent the IUT WAN. On R3:

```bash
interface serial0/0
  ip address <IUT‑WAN‑IP> <mask>
  no shutdown
exit
ip route 0.0.0.0 0.0.0.0 serial0/0
```

Ensure that any host in any VLAN can reach external resources through R3’s default route.

## Conclusion

By following this plan, you will build a secure, well‑segmented campus network with dynamic routing, essential services, and external connectivity—all while reinforcing fundamental networking concepts in a practical GNS3 environment.
