---
title: "Web Radio - Measuring and caracterizing an audio signal"
date: 2025-06-20
summary: "Characterisation of audio signals via an ESP32 programmed in Arduino using VS1053 Baldram libraries and open-source code."
categories: ['Project']
tags: ['Arduino', 'VS1053', 'C++', 'Codec']
---

## Introduction

This article presents a step-by-step guide to designing and implementing a portable Web Radio using the Adafruit HUZZAH32 (ESP32) Feather and the VS1053 audio codec. You will learn to set up the hardware, configure the software environment, stream Internet radio stations, fine-tune audio parameters, manage Wi-Fi connections dynamically, handle station URLs, integrate MQTT for remote control, and explore advanced extensions.

## Project Objectives

* Stream MP3/AAC Internet radio stations in stereo via headphones or speakers.
* Control station selection, volume, tone (bass/treble), and spatialization both via physical buttons and remotely from a smartphone.
* Implement dynamic Wi-Fi configuration to connect to any network without hard-coding credentials.
* Enhance station URL handling using a dedicated streaming library.
* Add remote control capabilities via MQTT and an Android IoT dashboard.

## 1. Hardware Environment

### 1.1 Adafruit HUZZAH32 ESP32 Feather

* **Microcontroller**: ESP32-WROOM with integrated Wi‑Fi and Bluetooth.
* **Power**: USB or LiPo battery via onboard charger.
* **Inputs/Outputs**: GPIO pins, SPI interface, push-button, status LED.

Refer to the Adafruit Learning Guide for detailed pinout and features. You will answer key questions to familiarize yourself:

* **Push-button function**
* **LED GPIO number**
* **GPIO definition and examples**
* **Quartz frequency**
* **LiPo charging capabilities**
* **SPI pins and protocol overview**

## 2. Software Environment

### 2.1 Arduino IDE Setup

* Install the Arduino IDE from arduino.cc.
* Add “ESP32 by Espressif” board support (latest version).
* Configure your Sketchbook folder and board/port settings.

### 2.2 Required Libraries

* **VS1053 library** (Baldram or Adafruit\_VS1053)
* **WiFiManager** (for dynamic Wi-Fi credentials)
* **ESP32\_VS1053\_Stream** (Cellie’s streaming library)
* **PubSubClient** (for MQTT connectivity)

## 3. VS1053 Audio Codec

* Study the VS1053 functional block diagram and datasheet.
* Identify its 6 SPI pins and distinguish SDI (data input) vs. SCI (control interface).
* Understand how to interface the codec with the ESP32 over SPI.

## 4. Adafruit Music Maker FeatherWing

* Mount the Music Maker FeatherWing onto the ESP32 Feather.
* Map its SPI pins (MISO, MOSI, SCK, MP3CS, DREQ, XDCS) to the Feather’s GPIO.
* Explore example sketches for SD‑card playback to validate hardware connections.

## 5. First Web Radio Sketch

* Base your code on Yves Pelletier’s adaptation of Baldram’s VS1053 library.
* Load sample stations and compile for your boards.
* Test basic streaming functionality and URL adjustments.

## 6. Audio Enhancements

Enhance the sketch to include real-time audio controls via button commands:

| Control Key | Function                |
| ----------- | ----------------------- |
| n / v       | Next / Previous station |
| y / b       | Volume up / down        |
| g / f       | Bass up / down          |
| j / h       | Treble up / down        |
| d           | Default tone settings   |
| s           | Toggle spatialization   |

* Use the VS1053 register interface for bass/treble adjustments.
* Implement spatialization modes by writing to the appropriate codec registers.

## 7. Wi‑Fi Configuration via WiFiManager

* Integrate the WiFiManager library to launch a captive portal on first boot.
* Allow users to select and authenticate to any 2.4 GHz network without hard-coded SSID/password.

## 8. Advanced URL Handling

* Replace manual host/path/port parsing with the ESP32\_VS1053\_Stream library.
* Stream directly from full URLs, simplifying sketch complexity.
* Ensure prior tone and spatialization features are re-integrated if lost.

## 9. MQTT Integration

* Learn MQTT fundamentals: lightweight publish/subscribe protocol ideal for IoT.
* Identify public brokers and client tools (MQTT.fx, MQTT Dash, etc.).
* Install and adapt the PubSubClient example for ESP32.
* Publish/subscribe to topics for volume, tone, station control.

## 10. Final Project: Remote Control Dashboard

* Use an Android app like IoT MQTT Panel to create a dashboard:

  * Real-time volume slider
  * Bass/treble sliders
  * Spatialization toggle
  * Station presets and custom URL entry
* Program ESP32 to respond to MQTT commands and publish status updates.

## 11. Possible Extensions

* Develop a native Android/iOS app or web interface.
* Add physical controls: potentiometers, OLED display, graphical equalizer plugin (EQ5).
* Implement SD‑card audio playback alongside streaming.
* Integrate additional DSP features or multi-band equalizer plugins.

## Conclusion

By following these steps, you will build a fully featured portable web radio—combining embedded hardware, audio processing, dynamic networking, and IoT integration. This project reinforces microcontroller programming, SPI communication, network protocols, and MQTT message handling in a practical application.
